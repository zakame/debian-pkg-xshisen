From: Joey Hess <joeyh@debian.org>
Subject: patch numerous security holes in xshisen
Date: Thu, 27 Jan 2005 03:05:30 -0500

Origin: vendor, http://bugs.debian.org/cgi-bin/bugreport.cgi?msg=55;bug=292065
Bug-Debian: http://bugs.debian.org/292065
---
 Makefile.in |   11 ++++++-----
 main.C      |    5 +++++
 menubar.C   |    5 +++++
 score.C     |    3 +++
 4 files changed, 19 insertions(+), 5 deletions(-)

--- a/Makefile.in	2003-10-29 11:49:58.000000000 -0500
+++ b/Makefile.in	2005-01-27 01:56:36.000000000 -0500
@@ -17,7 +17,7 @@
 
 XSHISENLIB = @datadir@/xshisen
 XSHISENDAT = @sharedstatedir@
-CXXFLAGS = @CXXFLAGS@
+CXXFLAGS = @CXXFLAGS@ -DNO_GLOBAL_HIGHSCORE
 CPPFLAGS = $(CPPOPTS) @CPPFLAGS@
 CPPOPTS  =
 LDFLAGS  = @LDFLAGS@
--- a/main.C	2003-10-29 11:53:41.000000000 -0500
+++ b/main.C	2005-01-27 02:27:48.000000000 -0500
@@ -353,6 +353,7 @@
     delete[] scorefile;
 
     if (globRes.scoreOnly) {
+#ifndef NO_GLOBAL_HIGHSCORE
         sc->DisplayScore(initial_game_state);
 #if USE_MOTIF
         XtAddCallback(*sc, XmNokCallback, (XtCallbackProc)ExitCB, NULL);
@@ -360,6 +361,10 @@
         XtAddCallback(XtNameToWidget(*sc, "*ok_button"),
                       XtNcallback, (XtCallbackProc)ExitCB, NULL);
 #endif
+#else /* NO_GLOBAL_HIGHSCORE */
+	fprintf(stderr, "System score files not enabled.\n");
+	exit(1);
+#endif /* NO_GLOBAL_HIGHSCORE */
     }
     else {
         GetGameSize(initial_game_state, num_piece_x, num_piece_y);
--- a/menubar.C	2002-07-08 01:37:11.000000000 -0400
+++ b/menubar.C	2005-01-27 02:22:48.000000000 -0500
@@ -158,8 +158,13 @@
                   (XtCallbackProc)GameCB, (XtPointer)1);
     XtAddCallback(XtNameToWidget(menushell0, "button_2"), XtNcallback,
                   (XtCallbackProc)GameCB, (XtPointer)2);
+#ifdef NO_GLOBAL_HIGHSCORE
+    XtVaSetValues(XtNameToWidget(menushell0, "button_3"), XtNsensitive,
+                  False, NULL);
+#else
     XtAddCallback(XtNameToWidget(menushell0, "button_3"), XtNcallback,
                   (XtCallbackProc)GameCB, (XtPointer)3);
+#endif
     XtAddCallback(XtNameToWidget(menushell0, "button_4"), XtNcallback,
                   (XtCallbackProc)GameCB, (XtPointer)4);
     XtAddCallback(XtNameToWidget(menushell0, "button_5"), XtNcallback,
--- a/score.C	2005-01-19 15:18:33.000000000 -0500
+++ b/score.C	2005-01-27 02:59:34.000000000 -0500
@@ -374,6 +374,8 @@
     struct passwd *pw;
     char   namebuf[142], myname[NAMELEN+1], gecos[128], *po;
 
+#ifndef NO_GLOBAL_HIGHSCORE
+    
     s1 = scoreToRegister / 1000;
     ms_to_hms(scoreToRegister, h, m, s);
     pw = getpwuid(getuid());
@@ -425,6 +427,7 @@
     sprintf(rec[i].time, "%2.2d:%2.2d:%2.2d", tp->tm_hour, tp->tm_min, tp->tm_sec);
     if (writefile() == 0)
         DisplayScore(game);
+#endif /* NO_GLOBAL_HIGHSCORE */
 }
 
 void
